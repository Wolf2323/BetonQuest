package org.betonquest.betonquest.command;

import org.betonquest.betonquest.api.config.ConfigAccessor;
import org.betonquest.betonquest.api.logger.BetonQuestLogger;
import org.betonquest.betonquest.api.logger.BetonQuestLoggerFactory;
import org.betonquest.betonquest.api.profile.OnlineProfile;
import org.betonquest.betonquest.api.profile.ProfileProvider;
import org.betonquest.betonquest.api.service.identifier.Identifiers;
import org.betonquest.betonquest.api.service.item.ItemManager;
import org.betonquest.betonquest.config.PluginMessage;
import org.betonquest.betonquest.data.PlayerDataStorage;
import org.betonquest.betonquest.feature.Backpack;
import org.betonquest.betonquest.feature.Backpack.DisplayType;
import org.betonquest.betonquest.kernel.processor.feature.CancelerProcessor;
import org.betonquest.betonquest.kernel.processor.feature.CompassProcessor;
import org.bukkit.command.Command;
import org.bukkit.command.CommandExecutor;
import org.bukkit.command.CommandSender;
import org.bukkit.entity.Player;
import org.bukkit.plugin.Plugin;

/**
 * The /compass command. It opens the list of quests.
 */
@SuppressWarnings("PMD.AvoidLiteralsInIfCondition")
public class CompassCommand implements CommandExecutor {

    /**
     * The logger factory.
     */
    private final BetonQuestLoggerFactory loggerFactory;

    /**
     * The plugin instance.
     */
    private final Plugin plugin;

    /**
     * Custom {@link BetonQuestLogger} instance for this class.
     */
    private final BetonQuestLogger log;

    /**
     * The plugin configuration file.
     */
    private final ConfigAccessor config;

    /**
     * The {@link PluginMessage} instance.
     */
    private final PluginMessage pluginMessage;

    /**
     * The profile provider instance.
     */
    private final ProfileProvider profileProvider;

    /**
     * The player data storage.
     */
    private final PlayerDataStorage playerDataStorage;

    /**
     * The canceler processor.
     */
    private final CancelerProcessor cancelerProcessor;

    /**
     * The compass processor.
     */
    private final CompassProcessor compassProcessor;

    /**
     * The item manager.
     */
    private final ItemManager itemManager;

    /**
     * The identifier registry.
     */
    private final Identifiers identifiers;

    /**
     * Creates a new executor for the /compass command.
     *
     * @param plugin            the plugin instance
     * @param loggerFactory     the logger factory
     * @param log               the logger that will be used for logging
     * @param config            the plugin configuration accessor
     * @param pluginMessage     the {@link PluginMessage} instance
     * @param profileProvider   the profile provider instance
     * @param playerDataStorage the player data storage
     * @param cancelerProcessor the canceler processor
     * @param compassProcessor  the compass processor
     * @param itemManager       the item manager
     * @param identifiers       the identifier registry
     */
    public CompassCommand(final Plugin plugin, final BetonQuestLoggerFactory loggerFactory, final BetonQuestLogger log,
                          final ConfigAccessor config, final PluginMessage pluginMessage, final ProfileProvider profileProvider,
                          final PlayerDataStorage playerDataStorage, final CancelerProcessor cancelerProcessor, final CompassProcessor compassProcessor,
                          final ItemManager itemManager, final Identifiers identifiers) {
        this.plugin = plugin;
        this.loggerFactory = loggerFactory;
        this.log = log;
        this.config = config;
        this.pluginMessage = pluginMessage;
        this.profileProvider = profileProvider;
        this.playerDataStorage = playerDataStorage;
        this.cancelerProcessor = cancelerProcessor;
        this.compassProcessor = compassProcessor;
        this.itemManager = itemManager;
        this.identifiers = identifiers;
    }

    @Override
    public boolean onCommand(final CommandSender sender, final Command cmd, final String label, final String[] args) {
        if ("compass".equalsIgnoreCase(cmd.getName())) {
            if (sender instanceof Player) {
                final OnlineProfile onlineProfile = profileProvider.getProfile((Player) sender);
                new Backpack(plugin, loggerFactory.create(Backpack.class), playerDataStorage.get(onlineProfile), cancelerProcessor,
                        compassProcessor, config, pluginMessage, onlineProfile, itemManager, identifiers, DisplayType.COMPASS);
            }
            return true;
        }
        return false;
    }
}
